match /projects/{projectId} {
  allow read: if true;

  allow create: if isAdmin();

  allow update: if isAdmin() && !touchingProjectAggregates();

  allow delete: if isAdmin();

  function touchingProjectAggregates() {
    // ✅ يمنع تعديل aggregates فقط إذا كانت ضمن الحقول المتغيرة فعلاً
    return request.resource.data.diff(resource.data).changedKeys().hasAny([
      "currentAmount",
      "investorsCount",
      "pendingAmount",
      "updatedAt"
    ]);
  }
}
